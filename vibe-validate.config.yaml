# vibe-validate configuration for mcp-typescript-simple
# See: https://github.com/jdutton/vibe-validate/blob/main/docs/configuration-reference.md

$schema: https://raw.githubusercontent.com/jdutton/vibe-validate/main/packages/config/vibe-validate.schema.json

developerFeedback: true

# Locking configuration - prevents concurrent validation runs from conflicting
# Using project-level locking since ports (3001, 64123, etc.) are shared across
# all directories running the same validation script
locking:
  enabled: true
  concurrencyScope: project
  projectId: mcp-typescript-simple

# Git settings
git:
  mainBranch: main

# Pre-commit hooks configuration
hooks:
  preCommit:
    enabled: true
    secretScanning:
      enabled: true
      scanCommand: "gitleaks protect --staged --verbose"

# Validation configuration
# Optimized for CI efficiency: fast checks on single runner, parallelize only slow tests
# Reduces GitHub Actions runners from 7 to 4 (50% cost savings)
validation:
  phases:
    # Phase 1: Fast Checks & Build (single runner, ~2-3 min)
    # Group all fast-running checks together to minimize runner overhead
    - name: 'Fast Checks & Build'
      parallel: false  # Run in series on one runner for efficiency
      steps:
        - name: TypeScript Type Check
          command: npm run typecheck
        - name: ESLint
          command: npm run lint
        - name: OpenAPI Validation
          command: npm run test:openapi
        - name: Security Check
          command: npm run security:check
        - name: Wildcard Dependencies Check
          command: npm run validate:wildcards
        - name: Contract Tests
          command: npm run test:contract:local
        - name: Build Packages
          command: npm run build
        - name: Unit Tests
          command: npm run test:unit
        - name: Integration Tests
          command: npm run test:integration

    # Phase 2: System Tests (3 parallel runners, ~3-5 min each)
    # Only parallelize long-running tests where it provides real benefit
    - name: 'System Tests'
      parallel: true  # Parallel execution for slow tests
      steps:
        - name: System Tests (STDIO)
          command: npm run test:system:stdio
        - name: System Tests (HTTP)
          command: npm run test:system:ci
        - name: Headless Browser Tests
          command: npx playwright install --with-deps chromium && npm run test:system:headless
        - name: Scaffolding Regression Test
          command: npm run test:regression --workspace=create-mcp-typescript-simple
